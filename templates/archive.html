<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê—Ä—Ö–∏–≤ –∑–∞–¥–∞—á - RGG QUEST</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <div class="mobile-menu-toggle" onclick="toggleSidebar()">
        <span>‚ò∞</span>
        <span>–ú–µ–Ω—é</span>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="toggleSidebar()"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">RGG QUEST</div>
                <div class="sidebar-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏</div>
            </div>

            <nav class="sidebar-nav">
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
                <div class="sidebar-section">
                    <div class="sidebar-section-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
                    <a href="/" class="sidebar-link">
                        <span class="sidebar-link-icon">üìã</span>
                        <span class="sidebar-link-text">–ì–ª–∞–≤–Ω–∞—è</span>
                    </a>
                    <a href="/map" class="sidebar-link">
                        <span class="sidebar-link-icon">üó∫Ô∏è</span>
                        <span class="sidebar-link-text">–ö–∞—Ä—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</span>
                    </a>
                    <a href="/archive" class="sidebar-link active">
                        <span class="sidebar-link-icon">üìö</span>
                        <span class="sidebar-link-text">–ê—Ä—Ö–∏–≤ –∑–∞–¥–∞—á</span>
                    </a>
                </div>

                {% if session.role == 'admin' %}
                <div class="sidebar-section">
                    <div class="sidebar-section-title">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                    <a href="/admin" class="sidebar-link">
                        <span class="sidebar-link-icon">‚öôÔ∏è</span>
                        <span class="sidebar-link-text">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    </a>
                </div>
                {% endif %}
            </nav>

            <!-- User Info -->
            <div class="sidebar-user">
                {% if 'username' in session %}
                <div class="user-profile">
                    <div class="user-avatar-large">
                        {{ session.username[0]|upper }}
                    </div>
                    <div class="user-info-compact">
                        <div class="user-name">{{ session.username }}</div>
                        <div class="user-role">{{ session.role }}</div>
                    </div>
                    <a href="/logout" class="btn btn-outline" style="padding: 6px 12px; font-size: 0.8em;">–í—ã–π—Ç–∏</a>
                </div>
                {% else %}
                <div style="display: flex; gap: 8px; flex-direction: column;">
                    <a href="/login" class="btn" style="width: 100%; text-align: center;">–í–æ–π—Ç–∏</a>
                    <a href="/register" class="btn btn-outline" style="width: 100%; text-align: center;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                </div>
                {% endif %}
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
            <div style="margin-bottom: 32px;">
                <h1 class="title">–ê—Ä—Ö–∏–≤ –∑–∞–¥–∞—á</h1>
                <p class="subtitle">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π</p>
            </div>

            {% if board %}
            <section class="panel">
                <h2 class="section-title">üìö –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–ó–∞–¥–∞—á–∞</th>
                                <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                                <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>
                                <th>–í–∑—è—Ç–∞</th>
                                <th>–ó–∞–≤–µ—Ä—à–µ–Ω–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in board %}
                            <tr>
                                <td>{{ task.text }}</td>
                                <td>
                                    <span class="difficulty difficulty-{{ task.difficulty|lower }}">
                                        {{ task.difficulty }}
                                    </span>
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(135deg, var(--text-accent), var(--text-accent2)); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.7em; font-weight: 600;">
                                            {{ task.user[0]|upper if task.user else '?' }}
                                        </div>
                                        {{ task.user or '‚Äî' }}
                                    </div>
                                </td>
                                <td>
                                    {% if task.taken_at %}
                                        {{ task.taken_at.split(' ')[0] }}
                                    {% else %}
                                        ‚Äî
                                    {% endif %}
                                </td>
                                <td>
                                    {% if task.done_at %}
                                        {{ task.done_at.split(' ')[0] }}
                                    {% else %}
                                        ‚Äî
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 20px; text-align: center; color: var(--text-secondary);">
                    <p>–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á: {{ board|length }}</p>
                </div>
            </section>
            {% else %}
            <section class="panel">
                <div class="empty-state">
                    <div class="empty-state-icon">üìö</div>
                    <h3>–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç</h3>
                    <p>–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</p>
                    <a href="/" class="btn" style="margin-top: 16px;">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞–Ω–∏—è–º</a>
                </div>
            </section>
            {% endif %}
        </main>
    </div>

    <script>
        // Mobile sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        // Close sidebar when clicking on a link (mobile)
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Update active link based on current page
            const currentPath = window.location.pathname;
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>