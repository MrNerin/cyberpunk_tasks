<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGG - QUEST</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="nav-bar">
            <div>
                <h1 class="title">–ü–æ–ø—ã—Ç–∫–∞ –≤ RGG</h1>
                <p class="subtitle">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</p>
            </div>

            <div class="nav-links">
                {% if 'username' in session %}
                <div class="user-info">
                    <div class="user-avatar">
                        {{ session.username[0]|upper }}
                    </div>
                    <span>{{ session.username }}</span>
                </div>
                <a href="/logout" class="btn btn-outline">–í—ã–π—Ç–∏</a>
                {% if session.role == 'admin' %}
                <a href="/admin" class="btn btn-secondary">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                {% endif %}
                {% else %}
                <a href="/login" class="btn">–í–æ–π—Ç–∏</a>
                <a href="/register" class="btn btn-outline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                {% endif %}
            </div>
        </header>

        <!-- User Stats -->
        {% if 'username' in session %}
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-value">{{ user_daily_done|length }}/3</div>
                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ (user_daily_done|length / 3 * 100) | round | int }}%"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ session.role|upper }}</div>
                <div class="stat-label">–í–∞—à —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞</div>
            </div>
        </div>
        {% endif %}

        <!-- Daily Tasks -->
        <section class="panel">
            <h2 class="section-title">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            </p>

            <div class="tasks-list">
                {% for task in daily %}
                <div class="card">
                    <div class="card-content">
                        <div class="card-text">{{ task }}</div>
                        <div class="card-actions">
                            {% if 'username' in session %}
                                {% if task not in user_daily_done %}
                                <form method="post" action="/mark_daily_done" style="display: inline;">
                                    <input type="hidden" name="task" value="{{ task }}">
                                    <button type="submit" class="btn btn-success">
                                        ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å
                                    </button>
                                </form>
                                {% else %}
                                <span class="status status-done">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                                {% endif %}
                            {% else %}
                                <a href="/login" class="btn btn-outline">–í–æ–π—Ç–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Task Board -->
        <section class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="section-title" style="margin-bottom: 0;">üìã –î–æ—Å–∫–∞ –∑–∞–¥–∞—á</h2>
                <a href="/archive" class="btn btn-outline">–ê—Ä—Ö–∏–≤ –∑–∞–¥–∞—á</a>
            </div>

            {% if board %}
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–ó–∞–¥–∞—á–∞</th>
                            <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in board %}
                        {% if task.status != 'done' %}
                        <tr>
                            <td>{{ task.text }}</td>
                            <td>
                                <span class="difficulty difficulty-{{ task.difficulty|lower }}">
                                    {{ task.difficulty }}
                                </span>
                            </td>
                            <td>
                                <span class="status status-{{ task.status }}">
                                    {% if task.status == 'free' %}–°–≤–æ–±–æ–¥–Ω–∞{% endif %}
                                    {% if task.status == 'taken' %}–í —Ä–∞–±–æ—Ç–µ{% endif %}
                                    {% if task.status == 'done' %}–í—ã–ø–æ–ª–Ω–µ–Ω–∞{% endif %}
                                </span>
                            </td>
                            <td>{{ task.user or '‚Äî' }}</td>
                            <td>
                                {% if 'username' not in session %}
                                    <a href="/login" class="btn btn-outline">–í–æ–π—Ç–∏</a>
                                {% elif task.status == 'free' %}
                                    <form method="post" action="/board/take/{{ task.id }}" style="display: inline;">
                                        <button type="submit" class="btn">–í–∑—è—Ç—å –∑–∞–¥–∞—á—É</button>
                                    </form>
                                {% elif task.status == 'taken' and task.user == session.get('username') %}
                                    <form method="post" action="/board/done/{{ task.id }}" style="display: inline;">
                                        <button type="submit" class="btn btn-success">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                                    </form>
                                {% elif task.status == 'taken' %}
                                    <span style="color: var(--text-secondary);">–ó–∞–Ω—è—Ç–æ: {{ task.user }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <p>–ù–∞ –¥–æ—Å–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</p>
                {% if session.role == 'admin' %}
                <a href="/admin" class="btn" style="margin-top: 16px;">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏</a>
                {% endif %}
            </div>
            {% endif %}
        </section>

        <!-- Quick Actions -->
        {% if 'username' in session %}
        <section class="panel">
            <h2 class="section-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <a href="/board" class="btn btn-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏</a>
                <a href="/archive" class="btn btn-outline">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö</a>
                {% if session.role == 'admin' %}
                <a href="/admin" class="btn">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</a>
                {% endif %}
            </div>
        </section>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Enhanced interactions
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });

                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });

            // Form handling
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = this.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        const originalText = submitBtn.innerHTML;
                        submitBtn.innerHTML = '<span class="loading-spinner"></span> –û–±—Ä–∞–±–æ—Ç–∫–∞...';
                        submitBtn.disabled = true;

                        setTimeout(() => {
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        }, 3000);
                    }
                });
            });

            // Button feedback
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });
        });
    </script>
</body>
</html>
