<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- –§–æ–Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã -->
    <div class="hologram-grid"></div>
    <div class="energy-wave"></div>
    <div class="scanline"></div>
    <div class="particles-container" id="particles"></div>

    <div class="container cyber-glow">
        <!-- === –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è === -->
        <h1 class="cyber-gradient">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h1>

        {% if 'username' in session %}
        <div class="daily-stats hud-element">
            <div class="hud-header">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</div>
            –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è: <strong>{{ user_daily_done|length }}/3</strong>
        </div>
        {% endif %}

        <div class="daily-tasks">
            {% for task in daily %}
            <div class="daily-task cyber-3d">
                <div class="daily-task-text">{{ task }}</div>

                {% if 'username' in session %}
                    {% if task not in user_daily_done %}
                    <form class="form-inline" method="post" action="/mark_daily_done">
                        <input type="hidden" name="task" value="{{ task }}">
                        <button type="submit" class="btn-cyber btn-cyber-success">
                            ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å
                        </button>
                    </form>
                    {% else %}
                    <span class="done-badge">
                        ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û
                    </span>
                    {% endif %}
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <div class="divider"></div>

        <h1 class="board-title">–î–û–°–ö–ê –ó–ê–î–ê–ù–ò–ô</h1>

        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ó–ê–î–ê–ù–ò–ï</th>
                    <th>–°–õ–û–ñ–ù–û–°–¢–¨</th>
                    <th>–°–¢–ê–¢–£–°</th>
                    <th>–û–ü–ï–†–ê–¢–û–†</th>
                    <th>–î–ï–ô–°–¢–í–ò–Ø</th>
                </tr>
            </thead>
            <tbody>
                {% for task in board %}
                {% if task.status != 'done' %}
                <tr>
                    <td>#{{ task.id }}</td>
                    <td>{{ task.text }}</td>
                    <td class="difficulty-{{ task.difficulty|lower }}">{{ task.difficulty }}</td>
                    <td class="status-{{ task.status }}">{{ task.status|upper }}</td>
                    <td>{{ task.user or '‚Äî' }}</td>
                    <td>
                        {% if 'username' not in session %}
                            <a href="/login" class="btn-cyber">üö™ –í–•–û–î</a>
                        {% elif task.status == 'free' %}
                            <form class="form-inline" method="post" action="/board/take/{{ task.id }}">
                                <button type="submit" class="btn-cyber">–í–ó–Ø–¢–¨</button>
                            </form>
                        {% elif task.status == 'taken' and task.user == session.get('username') %}
                            <form class="form-inline" method="post" action="/board/done/{{ task.id }}">
                                <button type="submit" class="btn-cyber">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</button>
                            </form>
                        {% elif task.status == 'taken' %}
                            –ó–∞–Ω—è—Ç–æ: {{ task.user }}
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>

        <br>
        <a href="/archive" class="btn-cyber">üìã –ê–†–•–ò–í</a>

        {% if 'username' not in session %}
        <br><br>
        <a href="/login" class="btn-cyber">üö™ –í–•–û–î</a>
        <a href="/register" class="btn-cyber">üë§ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</a>
        {% else %}
        <br><br>
        <p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong>{{ session.username }}</strong> | <a href="/logout">–í—ã–π—Ç–∏</a></p>
        {% if session.role == 'admin' %}
        <a href="/admin" class="btn-cyber">‚öôÔ∏è –ê–î–ú–ò–ù–ö–ê</a>
        {% endif %}
        {% endif %}
    </div>

    <div class="crt-cursor"></div>

    <script>
        // –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —á–∞—Å—Ç–∏—Ü
        function createParticles() {
            const container = document.getElementById('particles');
            if (!container) return;

            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 10 + 's';
                container.appendChild(particle);
            }
        }

        document.addEventListener('DOMContentLoaded', createParticles);
    </script>
</body>
</html>
